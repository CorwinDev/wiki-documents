"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[76759],{15680:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>c});var a=n(96540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},g=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=i,c=u["".concat(s,".").concat(d)]||u[d]||m[d]||o;return n?a.createElement(c,r(r({ref:t},g),{},{components:n})):a.createElement(c,r({ref:t},g))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7241:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(58168),i=(n(96540),n(15680));const o={description:"\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b",title:"\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b",keywords:["Contributor"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/cn/How_to_run_local_llm_text_to_image_on_reComputer",last_update:{date:"04/01/2024",author:"Bruno"}},r="\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b",l={unversionedId:"zh-CN/Edge/NVIDIA_Jetson/Application/Generative_AI/How_to_run_local_llm_text_to_image_on_reComputer",id:"zh-CN/Edge/NVIDIA_Jetson/Application/Generative_AI/How_to_run_local_llm_text_to_image_on_reComputer",title:"\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b",description:"\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b",source:"@site/docs/zh-CN/Edge/NVIDIA_Jetson/Application/Generative_AI/How_to_run_local_llm_text_to_image_on_reComputer.md",sourceDirName:"zh-CN/Edge/NVIDIA_Jetson/Application/Generative_AI",slug:"/cn/How_to_run_local_llm_text_to_image_on_reComputer",permalink:"/cn/How_to_run_local_llm_text_to_image_on_reComputer",draft:!1,editUrl:"https://github.com/Seeed-Studio/wiki-documents/blob/docusaurus-version/docs/zh-CN/Edge/NVIDIA_Jetson/Application/Generative_AI/How_to_run_local_llm_text_to_image_on_reComputer.md",tags:[],version:"current",lastUpdatedBy:"Bruno",lastUpdatedAt:1711929600,formattedLastUpdatedAt:"Apr 1, 2024",frontMatter:{description:"\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b",title:"\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b",keywords:["Contributor"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/cn/How_to_run_local_llm_text_to_image_on_reComputer",last_update:{date:"04/01/2024",author:"Bruno"}},sidebar:"CNSidebar",previous:{title:"\u91cf\u5316\u7684Llama2-7B\u4e0eMLC LLM\u5728Jetson\u4e0a\u7684\u5e94\u7528",permalink:"/cn/Quantized_Llama2_7B_with_MLC_LLM_on_Jetson"},next:{title:"\u5728NVIDIA Jetson Orin\u4e0a\u90e8\u7f72Whisper\u8fdb\u884c\u5b9e\u65f6\u8bed\u97f3\u8f6c\u6587\u5b57",permalink:"/zh-CN/Edge/NVIDIA_Jetson/Application/Generative_AI/Whisper_on_Jetson_for_Real_Time_Speech_to_Text"}},s={},p=[{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:2},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"\u7591\u96be\u89e3\u7b54",id:"\u7591\u96be\u89e3\u7b54",level:3},{value:"\u8981\u6c42",id:"\u8981\u6c42",level:2},{value:"\u6b65\u9aa41 - \u521b\u5efa\u865a\u62df\u73af\u5883",id:"\u6b65\u9aa41---\u521b\u5efa\u865a\u62df\u73af\u5883",level:3},{value:"TensorFlow",id:"tensorflow",level:5},{value:"PyTorch",id:"pytorch",level:5},{value:"1.1 Keras",id:"11-keras",level:4},{value:"\u6b65\u9aa4 1.2 - Hugging Face",id:"\u6b65\u9aa4-12---hugging-face",level:3},{value:"\u865a\u62df\u73af\u5883",id:"\u865a\u62df\u73af\u5883",level:4},{value:"\u6a21\u7ec4",id:"\u6a21\u7ec4",level:4},{value:"Step 1.3 - Create a small API",id:"step-13---create-a-small-api",level:3},{value:"Step 2 - Nvidia LLM",id:"step-2---nvidia-llm",level:3},{value:"Stable Diffusion v1.5",id:"stable-diffusion-v15",level:4},{value:"Stable Diffusion XL",id:"stable-diffusion-xl",level:4},{value:"Adding other models",id:"adding-other-models",level:4},{value:"\u2728 Contributor Project",id:"-contributor-project",level:2},{value:"Tech Support &amp; Product Discussion",id:"tech-support--product-discussion",level:2}],g={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,i.yg)(u,(0,a.A)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"\u5982\u4f55\u5728recomputer\u4e0a\u8fd0\u884c\u672c\u5730llm\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b"},"\u5982\u4f55\u5728reComputer\u4e0a\u8fd0\u884c\u672c\u5730LLM\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b"),(0,i.yg)("h2",{id:"\u4ecb\u7ecd"},"\u4ecb\u7ecd"),(0,i.yg)("p",null,"\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b\u662f\u4e00\u79cd\u6839\u636e\u6587\u672c\u63cf\u8ff0\u751f\u6210\u56fe\u50cf\u7684\u4eba\u5de5\u667a\u80fd\uff08AI\uff09\u6a21\u578b\u3002\u8fd9\u4e9b\u6a21\u578b\u63a5\u53d7\u6587\u672c\u8f93\u5165\uff0c\u5982\u63cf\u8ff0\u573a\u666f\u7684\u53e5\u5b50\u6216\u6bb5\u843d\uff0c\u5e76\u6839\u636e\u63cf\u8ff0\u751f\u6210\u56fe\u50cf\u3002"),(0,i.yg)("p",null,"\u8fd9\u4e9b\u6a21\u578b\u5728\u5305\u542b\u6210\u5bf9\u6587\u672c\u63cf\u8ff0\u548c\u76f8\u5e94\u56fe\u50cf\u7684\u5927\u578b\u6570\u636e\u96c6\u4e0a\u8fdb\u884c\u8bad\u7ec3\uff0c\u5b66\u4e60\u7406\u89e3\u6587\u672c\u4fe1\u606f\u548c\u89c6\u89c9\u4fe1\u606f\u4e4b\u95f4\u7684\u5173\u7cfb\u3002"),(0,i.yg)("p",null,"\u8fd1\u5e74\u6765\uff0c\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b\u53d6\u5f97\u4e86\u91cd\u5927\u8fdb\u5c55\uff0c\u4f46\u751f\u6210\u4e0e\u6587\u672c\u63cf\u8ff0\u7cbe\u786e\u5339\u914d\u7684\u9ad8\u8d28\u91cf\u3001\u591a\u6837\u5316\u56fe\u50cf\u4ecd\u662f\u4eba\u5de5\u667a\u80fd\u7814\u7a76\u4e2d\u7684\u4e00\u9879\u6311\u6218\u6027\u4efb\u52a1\u3002"),(0,i.yg)("h2",{id:"\u6545\u969c\u6392\u9664"},"\u6545\u969c\u6392\u9664"),(0,i.yg)("p",null,"\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u4eec\u5c06\u63a2\u8ba8\u90e8\u7f72\u548c\u8fd0\u884c\u672c\u5730 LLM \u6587\u672c\u5230\u56fe\u50cf\u7684\u51e0\u79cd\u65b9\u6cd5\uff1a"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"\u521b\u5efa\u865a\u62df\u73af\u5883\uff08\u5305\u62ec TensorFlow \u548c PyTorch\uff09")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"1.1. \u4f7f\u7528 Keras Stable Diffusion \u521b\u5efa\u4e00\u4e2a\u793a\u4f8b"),(0,i.yg)("li",{parentName:"ul"},"1.2. \u4f7f\u7528 Hugging Face \u63d0\u4f9b\u7684\u6a21\u578b\u4e4b\u4e00\u521b\u5efa\u4e00\u4e2a\u793a\u4f8b"),(0,i.yg)("li",{parentName:"ul"},"1.3. \u521b\u5efa\u4e00\u4e2a\u5c0f\u578b Python API\uff0c\u901a\u8fc7\u8c03\u7528 Keras \u548c Hugging Face \u7684 API \u6765\u751f\u6210\u56fe\u50cf\u3002")),(0,i.yg)("ol",{start:3},(0,i.yg)("li",{parentName:"ol"},"\u4f7f\u7528 Nvidia \u5bb9\u5668\u3002")),(0,i.yg)("h3",{id:"\u7591\u96be\u89e3\u7b54"},"\u7591\u96be\u89e3\u7b54"),(0,i.yg)("p",null,"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u6b65\u9aa4\u6765\u589e\u52a0\u53ef\u7528\u5185\u5b58."),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"\u7981\u7528\u684c\u9762\u56fe\u5f62\u7528\u6237\u754c\u9762\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 SSH \u4f7f\u7528 Jetson\u3002\u8fd9\u6837\u53ef\u4ee5\u8282\u7701\u7ea6 800MB \u5185\u5b58.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"\u7981\u7528 ZRAM \u5e76\u4f7f\u7528 Swap. "))),(0,i.yg)("p",null,"\u4f60\u53ef\u4ee5\u5728",(0,i.yg)("a",{parentName:"p",href:"https://www.jetson-ai-lab.com/tips_ram-optimization.html"},"\u82f1\u4f1f\u8fbe Jetson \u4eba\u5de5\u667a\u80fd\u5b9e\u9a8c\u5ba4")," \u4e2d\u627e\u5230\u8fd9\u4e9b\u63d0\u793a\u4ee5\u53ca\u5982\u4f55\u5b9e\u73b0\u5b83\u4eec\u3002 "),(0,i.yg)("h2",{id:"\u8981\u6c42"},"\u8981\u6c42"),(0,i.yg)("p",null,"\u5728\u672c\u6559\u7a0b\u4e2d, \u6211\u4eec\u9700\u8981\u4e00\u4e2aNvidia ",(0,i.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/reComputer-J4012-p-5586.html"},"Jetson Orin NX 16GB"),"."),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/reComputer/Application/reComputer_J4012.png"})),(0,i.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,i.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/reComputer-J4012-p-5586.html?queryID=3d7dba9378be2accafeaff54420edb6a&objectID=5586&indexName=bazaar_retailer_products"},(0,i.yg)("strong",null,(0,i.yg)("span",null,(0,i.yg)("font",{color:"FFFFFF",size:"4"}," \u7acb\u5373\u8d2d\u4e70 \ud83d\uddb1\ufe0f"))))),(0,i.yg)("p",null,"\u6211\u4eec\u8fd8\u9700\u8981\u786e\u4fdd\u5b89\u88c5\u4e86 ",(0,i.yg)("strong",{parentName:"p"},"TensorFlow"),"\u548c ",(0,i.yg)("strong",{parentName:"p"},"PyTorch"),"\uff0c\u4e0d\u8fc7\u6211\u4f1a\u5728\u8fd9\u91cc\u6328\u4e2a\u8bf4\u660e. "),(0,i.yg)("h3",{id:"\u6b65\u9aa41---\u521b\u5efa\u865a\u62df\u73af\u5883"},"\u6b65\u9aa41 - \u521b\u5efa\u865a\u62df\u73af\u5883"),(0,i.yg)("p",null,"Keras\u53ef\u4ee5\u4f7f\u7528TensorFlow\u6216PyTorch\u4f5c\u4e3a\u540e\u7aef\u3002 Hugging Face\u4e3b\u8981\u4f7f\u7528PyTorch."),(0,i.yg)("p",null,"\u8ba9\u6211\u4eec\u5b89\u88c5TensorFlow\u548cPyTorch. "),(0,i.yg)("p",null,"\u5173\u4e8e\u5982\u4f55\u4e3aJetson Orin NX\u5b89\u88c5TensorFlow\u548cPyTorch\u7684\u8bf4\u660e\u5728",(0,i.yg)("a",{parentName:"p",href:"https://docs.nvidia.com/deeplearning/frameworks/install-tf-jetson-platform/index.html"},"Nvidia \u7f51\u7ad9"),"."),(0,i.yg)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5168\u5c40\u5b89\u88c5 TensorFlow \u548c PyTorch\uff0c\u6216\u8005\u5728\u865a\u62df\u73af\u5883\u4e2d\u5b89\u88c5\u3002\u6211\u4eec\u5c06\u4f7f\u7528\u865a\u62df\u73af\u5883\u3002"),(0,i.yg)("p",null,"\u901a\u8fc7\u4f7f\u7528\u865a\u62df\u73af\u5883\uff0c\u6211\u4eec\u4e0d\u4f1a\u9762\u4e34\u9879\u76ee\u6216\u8f6f\u4ef6\u5305\u7248\u672c\u6df7\u5408\u7684\u98ce\u9669. "),(0,i.yg)("p",null,"\u8fd9\u662f\u6700\u597d\u7684\u65b9\u6cd5\uff0c\u5c3d\u7ba1 Nvidia \u7f51\u7ad9\u66f4\u503e\u5411\u4e8e\u4f7f\u7528\u5168\u5c40\u65b9\u6cd5. "),(0,i.yg)("h5",{id:"tensorflow"},"TensorFlow"),(0,i.yg)("p",null,"\u521b\u5efa\u865a\u62df\u73af\u5883\uff08\u6211\u4f7f\u7528 kerasStableEnvironment \u4f5c\u4e3a\u540d\u79f0\uff0c\u56e0\u4e3a\u6211\u5c06\u5728 keras \u793a\u4f8b\u4e2d\u4f7f\u7528\u5b83\u3002\u5982\u679c\u4f60\u613f\u610f\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u540d\u79f0\uff09"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"sudo apt install python3.8-venv\npython -m venv kerasStableEnvironment\n")),(0,i.yg)("p",null,"\u521b\u5efa\u540e\uff0c\u6fc0\u6d3b\u865a\u62df\u73af\u5883"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"source kerasStableEnvironment/bin/activate\n")),(0,i.yg)("p",null,"\u5f53\u73af\u5883\u6fc0\u6d3b\u65f6\uff0c\u4f60\u4f1a\u5728\u63d0\u793a\u7b26\u524d\u770b\u5230\u5b83\u7684\u540d\u79f0"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/1_prompt_bash.png"})),(0,i.yg)("p",null,"\u8fdb\u5165\u865a\u62df\u73af\u5883"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"cd kerasStableEnvironment\n")),(0,i.yg)("p",null,"\u5347\u7ea7 PIP \u5e76\u5b89\u88c5\u4e00\u4e9b\u4f9d\u8d56\u9879"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"pip install -U pip\npip install -U numpy grpcio absl-py py-cpuinfo psutil portpicker six mock requests gast h5py astor termcolor protobuf keras-applications keras-preprocessing wrapt google-pasta setuptools testresources\n")),(0,i.yg)("p",null,"\u4e3a Jetpack 5.1.1 \u5b89\u88c5 TensorFlow"),(0,i.yg)("p",null,"\u8981\u67e5\u627e\u6211\u4eec\u62e5\u6709\u7684 JetPack \u7248\u672c\uff0c\u8bf7\u53d1\u51fa\u4ee5\u4e0b\u547d\u4ee4\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"dpkg -l | grep -i jetpack\n")),(0,i.yg)("p",null,"\u7ed3\u679c\u5e94\u663e\u793a jetpack \u7248\u672c\uff1a"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/2_jetpack_version.png"})),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"pip install --extra-index-url https://developer.download.nvidia.com/compute/redist/jp/v511 tensorflow==2.12.0+nv23.05\n")),(0,i.yg)("p",null,"\u5982\u679c\u4f60\u6709\u5176\u4ed6 JetPack \u7248\u672c\uff0c\u8bf7\u68c0\u67e5 ",(0,i.yg)("a",{parentName:"p",href:"https://docs.nvidia.com/deeplearning/frameworks/install-tf-jetson-platform/index.html"},"Nvidia\u5b98\u7f51"),"\u4f7f\u7528\u6b63\u786e\u7684 URL\u3002. "),(0,i.yg)("p",null,"\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u68c0\u67e5 TensorFlow \u7684\u5b89\u88c5"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"python -c \"import tensorflow as tf; print(tf.config.list_physical_devices('GPU'))\"\n")),(0,i.yg)("p",null,"\u8fd9\u5e94\u8be5\u8fd4\u56de\u4ee5\u4e0b\u884c\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"[PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]\n")),(0,i.yg)("h5",{id:"pytorch"},"PyTorch"),(0,i.yg)("p",null,"\u8ba9\u6211\u4eec\u5b89\u88c5\u4e00\u4e9b\u4f9d\u8d56\u9879"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"sudo apt install libopenblas-dev\n")),(0,i.yg)("p",null,"\u73b0\u5728\uff0c\u4e3aJetPack 5.1.1\u5b89\u88c5PyTorch"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"pip install --no-cache https://developer.download.nvidia.com/compute/redist/jp/v511/pytorch/torch-2.0.0+nv23.05-cp38-cp38-linux_aarch64.whl\n")),(0,i.yg)("p",null,"\u68c0\u67e5\u5b89\u88c5\u4ee5\u53caCUDA\u662f\u5426\u53ef\u7528"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},'python -c "import torch; print(torch.cuda.is_available())"\n')),(0,i.yg)("p",null,"\u5b83\u5e94\u8be5\u8fd4\u56de ",(0,i.yg)("strong",{parentName:"p"},"\u771f")),(0,i.yg)("p",null,"\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5b89\u88c5\u4e86TensorFlow\u548cPyTorch\uff0c\u8ba9\u6211\u4eec\u5b89\u88c5Keras\u5e76\u521b\u5efa\u4e00\u4e2a\u56fe\u50cf"),(0,i.yg)("h4",{id:"11-keras"},"1.1 Keras"),(0,i.yg)("p",null,"\u5b89\u88c5\u540e ",(0,i.yg)("strong",{parentName:"p"},"PyTorch")," \u548c ",(0,i.yg)("strong",{parentName:"p"},"Tensorflow"),"\uff0c\u6211\u4eec\u73b0\u5728\u51c6\u5907\u5f00\u59cb\u4ece\u6587\u672c\u63d0\u793a\u521b\u5efa\u56fe\u50cf\u3002"),(0,i.yg)("p",null,"\u786e\u4fdd\u4f60\u4ecd\u7136\u5728\u865a\u62df\u73af\u5883\u4e2d."),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://keras.io/keras_cv/"},"KerasCV")," \u6709\u4e00\u4e2a\u5b9e\u73b0\uff08\u4ee5\u53ca\u5176\u4ed6\u51e0\u4e2a\uff09 ",(0,i.yg)("a",{parentName:"p",href:"https://stability.ai/"},"Stability.ai")," \u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b, ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/CompVis/stable-diffusion"},"\u7a33\u5b9a\u6269\u6563"),". "),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://keras.io/guides/keras_cv/generate_images_with_stable_diffusion/"},"\u901a\u8fc7\u4f7f\u7528 KerasCV \u5b9e\u73b0"),", \u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4e00\u4e9b\u6027\u80fd\u4f18\u52bf\uff0c\u6bd4\u5982XLA\u7f16\u8bd1\u548c\u6df7\u5408\u7cbe\u5ea6\u652f\u6301\u3002"),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://keras.io/guides/keras_cv/generate_images_with_stable_diffusion/"},"\u4f60\u53ef\u4ee5\u5728Keras\u7f51\u7ad9\u4e0a\u9605\u8bfb\u66f4\u591a\u4fe1\u606f")),(0,i.yg)("p",null,"\u5b89\u88c5keras\u53ca\u5176\u4f9d\u8d56\u9879\u3002 \u6211\u4eec\u9009\u62e9\u8fd9\u4e2a\u7248\u672c\u662f\u56e0\u4e3a\u5b83\u4eec\u4e0e\u6211\u4eec\u5df2\u5b89\u88c5\u7684TensorFlow\uff08\u6216PyTorch\uff09\u7248\u672c\u517c\u5bb9. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"pip install keras-cv==0.5.1\npip install keras==2.12.0\npip install Pillow\n")),(0,i.yg)("p",null,"\u6253\u5f00\u4f60\u559c\u6b22\u7684\u7f16\u8f91\u5668\uff0c\u8f93\u5165\u4ee5\u4e0b\u793a\u4f8b"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"vi generate_image.py\n")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},'import keras_cv\nimport keras\nfrom PIL import Image\n\nkeras.mixed_precision.set_global_policy("mixed_float16")\n\nmodel = keras_cv.models.StableDiffusion (\n        img_width=512,  # we can choose another size, but has to be a mutiple of 128\n        img_height=512, # the same above\n        jit_compile=True\n)\n\nprompt = "a cute magical flying dog, fantasy art, golden color, high quality, highly detailed, elegant, sharp focus, concept art, character concepts, digital painting, mystery, adventure"\n\nimage = model.text_to_image (prompt,\n        num_steps = 25, #image quality\n        batch_size = 1 # how many images to generate at once\n)\n\nImage.fromarray(image[0]).save("keras_generate_image.png")\n')),(0,i.yg)("p",null,"\u5728\u8fd0\u884c\u811a\u672c\u65f6\uff0c\u8fd9\u91cc\u6709\u4e00\u4e9b\u7edf\u8ba1\u4fe1\u606f"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/3_statistics.png"})),(0,i.yg)("p",null,"\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u8fd9\u91cc\u662f\u7ed3\u679c"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/4_keras_generate_image.png"})),(0,i.yg)("h3",{id:"\u6b65\u9aa4-12---hugging-face"},"\u6b65\u9aa4 1.2 - Hugging Face"),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://huggingface.co/"},"Hugging Face")," \u5c31\u50cf\u662f\u673a\u5668\u5b66\u4e60\u7684 Github\u3002\u5b83\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u6784\u5efa\u3001\u90e8\u7f72\u3001\u5171\u4eab\u548c\u8bad\u7ec3\u4ed6\u4eec\u7684 ML \u6a21\u578b"),(0,i.yg)("p",null,"Hugging Face \u8fd8\u56e0\u5176 Transformers Python \u5e93\u800c\u95fb\u540d\uff0c\u8be5\u5e93\u53ef\u7b80\u5316\u4e0b\u8f7d\u548c\u8bad\u7ec3 ML \u6a21\u578b\u7684\u8fc7\u7a0b\u3002"),(0,i.yg)("p",null,"\u8ba9\u6211\u4eec\u4f7f\u7528\u4e00\u4e9b\u53ef\u7528\u7684\u6a21\u578b\u3002\n\u524d\u5f80Hugging Face\u5e76\u9009\u62e9\u67e5\u770b\u6a21\u578b\u3002"),(0,i.yg)("p",null,"\u5728\u5de6\u4fa7\uff0c\u4f60\u6709\u8fc7\u6ee4\u5668\uff0c\u53ef\u4ee5\u9009\u62e9\u6211\u4eec\u60f3\u8981\u67e5\u770b\u7684\u6a21\u578b\u7c7b\u578b\u3002"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/5_huggingface.png"})),"\u6709\u5f88\u591a\u53ef\u7528\u7684\u6a21\u578b\uff0c\u4f46\u6211\u4eec\u53ea\u8ba8\u8bba\u6587\u672c\u5982\u4f55\u751f\u6210\u56fe\u50cf\u6a21\u578b\u3002",(0,i.yg)("h4",{id:"\u865a\u62df\u73af\u5883"},"\u865a\u62df\u73af\u5883"),(0,i.yg)("p",null,"\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u73af\u5883\uff0c\u5c31\u50cf\u6211\u4eec\u4e0a\u9762\u6240\u505a\u7684\u90a3\u6837\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528Hugging Face\uff0c\u800c\u4e0d\u4f1a\u6df7\u6dc6\u5305\u7248\u672c\u6216\u5b89\u88c5\u4e0d\u9700\u8981\u7684\u5305. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"python -m venv huggingfaceTesting\nsource huggingfaceTesting/bin/activate\n")),(0,i.yg)("p",null,"\u521b\u5efa\u865a\u62df\u73af\u5883\u540e\uff0c\u8ba9\u6211\u4eec\u8fdb\u5165\u5b83.\n\u4f7f\u7528\u4e0a\u9762\u7684\u8bf4\u660e\u5b89\u88c5PyTorch."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"cd huggingfaceTesting\n")),(0,i.yg)("h4",{id:"\u6a21\u7ec4"},"\u6a21\u7ec4"),(0,i.yg)("p",null,"Hugging Face \u6709\u5f88\u591a ",(0,i.yg)("a",{parentName:"p",href:"https://huggingface.co/models?pipeline_tag=text-to-image&sort=trending"},"\u6587\u672c\u5230\u56fe\u50cf\u6a21\u578b"),". \u867d\u7136\u7406\u8bba\u4e0a\u5b83\u4eec\u5e94\u8be5\u4e0e\u6211\u4eec\u7684 Jetson \u4e00\u8d77\u5de5\u4f5c\uff0c\u4f46\u5e76\u6ca1\u6709. "),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"stable-diffusion-v1-5")),(0,i.yg)("p",null,"\u6211\u5c06\u6d4b\u8bd5Runaway\u7684",(0,i.yg)("a",{parentName:"p",href:"https://huggingface.co/runwayml/stable-diffusion-v1-5"},"stable-diffusion-v1-5\u7248\u672c"),". "),(0,i.yg)("p",null,"\u5728\u6a21\u578b\u5361\u4e0a\uff0c\u4ed6\u4eec\u6709\u4f7f\u7528\u6a21\u578b\u6240\u9700\u7684\u6240\u6709\u4fe1\u606f . "),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/6_stable_diffusion_v1_5.png"})),(0,i.yg)("p",null,"\u6211\u4eec\u5c06\u4f7f\u7528 Hugging Face \u6269\u6563\u5668\u5e93\u3002\n\u5728\u865a\u62df\u73af\u5883\u4e2d\uff08\u6fc0\u6d3b\u540e\uff09\u5b89\u88c5\u4f9d\u8d56\u9879\u3002"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"pip install diffusers transformers accelerate\n")),(0,i.yg)("p",null,"\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5b89\u88c5\u4e86\u6240\u6709\u4f9d\u8d56\u9879\uff0c\u8ba9\u6211\u4eec\u6765\u8bd5\u8bd5\u6a21\u578b\u3002\n\u4f7f\u7528\u60a8\u559c\u6b22\u7684\u7f16\u8f91\u5668\uff0c\u590d\u5236\u4ee5\u4e0b\u4ee3\u7801\uff08\u4e5f\u53ef\u5728\u6a21\u578b\u5361\u9875\u9762\u4e2d\u627e\u5230\uff09\uff1a"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},'from diffusers import StableDiffusionPipeline\nimport torch\n\nmodel_id = "runwayml/stable-diffusion-v1-5"\npipe = StableDiffusionPipeline.from_pretrained(model_id, torch_dtype=torch.float16)\npipe = pipe.to("cuda")\n\nprompt = "a master jedi cat in star wars holding a lightsaber, wearing a jedi cloak hood, dramatic, cinematic lighting"\nimage = pipe(prompt).images[0]  \n    \nimage.save("cat_jedi.png")\n\n')),(0,i.yg)("p",null,"\u8ba9\u6211\u4eec\u8bd5\u8bd5\u8fd9\u4e2a\u6a21\u578b. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"python stableDiffusion.py\n")),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"\u63d0\u793a\uff1a")," \u8fd9\u5c06\u5360\u7528\u5927\u91cf\u7a7a\u95f4\u3002\u6b63\u5728\u4e0b\u8f7d\u6a21\u578b\u7684\u68c0\u67e5\u70b9\u3002\u53ea\u80fd\u4e0b\u8f7d\u4e00\u6b21\u3002"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/7_model_download.png"})),"\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\uff0c\u7ed3\u679c\u662f\u8fd9\u6837\u7684",(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/8_result_stablediffusion.png"})),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"SDXL-Turbo")),(0,i.yg)("p",null,"Here's another model we can try. ",(0,i.yg)("a",{parentName:"p",href:"https://huggingface.co/stabilityai/sdxl-turbo"},"SDXL Turbo from Stability AI."),"\nCopy the following code"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},'from diffusers import AutoPipelineForText2Image\nimport torch\n\npipe = AutoPipelineForText2Image.from_pretrained("stabilityai/sdxl-turbo", torch_dtype=torch.float16, variant="fp16")\npipe.to("cuda")\n\nprompt = "full body, cat dressed as a Viking, with weapon in his paws, battle coloring, glow hyper-detail, hyper-realism, cinematic"\n\nimage = pipe(prompt=prompt, num_inference_steps=1, guidance_scale=0.0).images[0]\nimage.save("sdxl-turbo.png")\n')),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://medium.com/phygital/top-40-useful-prompts-for-stable-diffusion-xl-008c03dd0557"},"This prompt was taken from a Medium article written by Daria Wind")),(0,i.yg)("p",null,"This one is really fast generating an image. Takes almost 30s, from running the script until it exits.\nHere's the result"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/9_sdxl-turbo.png"})),(0,i.yg)("p",null,"We can also try other models, like models trained specifically for anime or cyberpunk. "),(0,i.yg)("p",null,"There will be some models that will not work. It can be because of several factors - memory, available CPUs or even Swap memory. "),(0,i.yg)("h3",{id:"step-13---create-a-small-api"},"Step 1.3 - Create a small API"),(0,i.yg)("p",null,"Let's now crete a small API with Flask to use to generate an image given a prompt and return it to the caller. "),(0,i.yg)("p",null,"Imagine that you have the Jetson running and want to be able to generate an image by calling a API - your personal LLM image-to-text."),(0,i.yg)("p",null,"There are already projects that do this (like the one we're going to see later), but nothing beats doing it yourself. "),(0,i.yg)("p",null,"Let's create a new Virtual Environment"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"python -m venv imageAPIGenerator\n")),(0,i.yg)("p",null,"Activate the environment and enter it"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"source  imageAPIGenerator/bin/activate\ncd imageAPIGenerator\n")),(0,i.yg)("p",null,"We're going go use Flask for this. ",(0,i.yg)("a",{parentName:"p",href:"https://flask.palletsprojects.com/en/3.0.x/"},"FlasK")," is web application framework written in Python. It's small enough for our purpose. "),(0,i.yg)("p",null,"Install Flask."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"pip install Flask\n")),(0,i.yg)("p",null,"After installing it, let's install all the other dependencies that we need. Just for demonstration purposes, we're going to use Keras, because it has the least dependencies. "),(0,i.yg)("p",null,"Install TensorFlow. Follow the instructions above.\nNext, install Keras."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"pip install keras-cv==0.5.1\npip install keras==2.12.0\npip install Pillow\n")),(0,i.yg)("p",null,"Now, let's start to write our application. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"vi app.py\n")),(0,i.yg)("p",null,"For those who don't know what Flask is or does, let's try a small example. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},'from flask import Flask\n\napp = Flask (__name__)\n\n\n@app.route("/generate_image")\ndef generate_image_api():\n    return "<h2>Hello World !</h2>"\n\n\nif __name__ == "__main__":\n    app.run(host=\'\',port=8080)\n')),(0,i.yg)("p",null,"To run, execute the python script:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"python app.py\n")),(0,i.yg)("p",null,"You should see the following:"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/10_run_flask.png"})),(0,i.yg)("p",null,"Now, open a browser and try to access your Jetson device with the 8080 port."),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/11_browser_access.png"}),(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/12_accessed_flask.png"})),(0,i.yg)("p",null,"What we did was importing the Flask class"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},"import Flask\n")),(0,i.yg)("p",null,"We next created an instance of the Flask class"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},"app = Flask(__name__)\n")),(0,i.yg)("p",null,"We next create a route decorator to tell Flask what URL will trigger our function"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},'@app.route("/generate_image")\n')),(0,i.yg)("p",null,"When using generate_image in the URL, we will trigger our function"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},'def generate_image_api():\n    return "<h2>Hello World !</h2>"\n')),(0,i.yg)("p",null,"We can also use curl to access our API"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"curl http://192.168.2.230:8080/generate_image\n")),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/13_curl.png"})),"Now that we know how to create a API, let's dive into it and write it.",(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"vi app.py\n")),(0,i.yg)("p",null,"And paste the code"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-python"},'from flask import Flask, request, send_file\nimport random, string\nimport keras_cv\nimport keras\nfrom PIL import Image\n\n#define APP\napp = Flask (__name__)\n\n\n#option for keras\nkeras.mixed_precision.set_global_policy("mixed_float16")\n\n# generate custom filename\ndef generate_random_string(size):\n    """Generate a random string of specified size."""\n    return \'\'.join(random.choices(string.ascii_letters + string.digits, k=size))\n\n\n"""\n    This is the function that will generate the image\n    and save it using a random created filename\n"""\ndef generate_image(prompt):\n\n    model = keras_cv.models.StableDiffusion (\n        img_width=512,  # we can choose another size, but has to be a mutiple of 128\n        img_height=512, # the same above\n        jit_compile=True\n    )\n\n    image = model.text_to_image (prompt,\n            num_steps = 25,\n            batch_size = 1\n    )\n\n    # image filename\n    filename = generate_random_string(10) + ".png"\n    Image.fromarray(image[0]).save(filename)\n    return filename # return filename to send it to client\n\n\n#define routes\n# Use this to get the prompt. we\'re going to receive it using GET\n@app.route("/generate_image", methods=["GET"])\ndef generate_image_api():\n    # get the prompt\n    prompt = request.args.get("prompt")\n    if not prompt:\n        # let\'s define a default prompt\n        prompt = "A cinematic shot of a baby racoon wearing an intricate italian priest robe."\n\n    image_name = generate_image(prompt)\n    return send_file(image_name, mimetype=\'image/png\')\n\n\nif __name__ == "__main__":\n    app.run(host=\'0.0.0.0\',port=8080)\n')),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"REMEMBER:")," This is not code ready for the Internet. We don't have any security measures whatsoever. "),(0,i.yg)("p",null,"Let's run it."),(0,i.yg)("p",null,"In a browser, type in the URL ",(0,i.yg)("em",{parentName:"p"},"http://jetsonIP:8080/generate_image")," and wait. "),(0,i.yg)("p",null,"If we don't give it a prompt, it will use the default one we've set."),(0,i.yg)("p",null,"In the CLI, you can see the image being generated"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/14_generating_image_api.png"})),(0,i.yg)("p",null,"And in the browser, after a while, we can see the image"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/15_image_API_generated.png"})),(0,i.yg)("p",null,"We can also see the image has been sent"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/16_cli_generated.png"})),(0,i.yg)("p",null,"We can also use curl to get the image and save it."),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/17_cli_generating.png"})),(0,i.yg)("p",null,"If we want to give it a prompt (as we should), the URL will look like\n",(0,i.yg)("em",{parentName:"p"},"http://jetsonIP:8080/generate_image?prompt=<your_prompt>")),(0,i.yg)("p",null,"We can expand this example to build a better page, like having some text boxes for user input, a nice background, etc. But this is for another project. "),(0,i.yg)("h3",{id:"step-2---nvidia-llm"},"Step 2 - Nvidia LLM"),(0,i.yg)("h4",{id:"stable-diffusion-v15"},"Stable Diffusion v1.5"),(0,i.yg)("p",null,"We can use the ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/dusty-nv/jetson-containers"},"Jetson Containers")," project to run ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/AUTOMATIC1111/stable-diffusion-webui"},"stable-diffusion-webui using AUTOMATIC1111"),".\nJetson Containers project is run by ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/dusty-nv"},"Dusty Franklin"),", a NVIDIA employee."),(0,i.yg)("p",null,"NVIDIA has the ",(0,i.yg)("a",{parentName:"p",href:"https://www.jetson-ai-lab.com/tutorial-intro.html"},"NVIDIA Jetson Generative AI Lab")," project that has a lot of tutorials on Machine Learning. "),(0,i.yg)("p",null,"We're going to use ",(0,i.yg)("a",{parentName:"p",href:"https://www.jetson-ai-lab.com/tutorial_stable-diffusion.html"},"Stable Diffusion tutorial")," for this. "),(0,i.yg)("p",null,"Let's clone the github repository, enter the repository and install dependencies"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/dusty-nv/jetson-containers\ncd jetson-containers/\nsudo apt update; sudo apt install -y python3-pip\npip3 install -r requirements.txt\n")),(0,i.yg)("p",null,"Now that we have everything we need, let's run the container with the ",(0,i.yg)("em",{parentName:"p"},"stable-diffusion-webui autotag")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"./run.sh $(./autotag stable-diffusion-webui)\n")),(0,i.yg)("p",null,"It will start to run the container. "),(0,i.yg)("p",null,"After a while, it will say that there's a compatible container and if we want to proceed. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"Found compatible container dustynv/stable-diffusion-webui:r35.3.1 (2024-02-02, 7.3GB) - would you like to pull it? [Y/n] \n")),(0,i.yg)("p",null,"It will start downloading the container. "),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/18_container_downloading.png"})),(0,i.yg)("p",null,"After finishing, it will download the model and run the server on port 7860."),(0,i.yg)("p",null,"Here for me it didn't work at first. No checkpoint would appear to choose from, no matter how many times I would press the refresh\nbutton. "),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/20_no_checkpoint.png"})),(0,i.yg)("p",null,"I found out that I had 100% space occupied. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"feiticeir0@JetsonOrin:~$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/nvme0n1p1   79G   79G     0 100% /\nnone            7,4G     0  7,4G   0% /dev\ntmpfs           7,6G     0  7,6G   0% /dev/shm\ntmpfs           1,6G   19M  1,5G   2% /run\ntmpfs           5,0M  4,0K  5,0M   1% /run/lock\ntmpfs           7,6G     0  7,6G   0% /sys/fs/cgroup\n/dev/loop0      162M  162M     0 100% /snap/chromium/2797\n/dev/loop2      128K  128K     0 100% /snap/bare/5\n/dev/loop1       70M   70M     0 100% /snap/core22/1125\n/dev/loop3       65M   65M     0 100% /snap/cups/1025\n/dev/loop4       92M   92M     0 100% /snap/gtk-common-themes/1535\n/dev/loop6      162M  162M     0 100% /snap/chromium/2807\n/dev/loop5      483M  483M     0 100% /snap/gnome-42-2204/174\n/dev/loop7       35M   35M     0 100% /snap/snapd/21185\ntmpfs           1,6G  4,0K  1,6G   1% /run/user/1000\n")),(0,i.yg)("p",null,"I've been testing other models and they occupied all the space.\nIf this happens to you, just go to your home directory, to the hidden cache directory and delete the huggingface directory. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"cd ~/.cache\nrm -rf huggingface\n")),(0,i.yg)("p",null,"Now you should have space available. Or just get a new drive, with more space. :)"),(0,i.yg)("p",null,"Now the model is being downloaded."),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/21_mode_downloading.png"})),"And we have a checkpoint",(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/22_checkpoint.png"})),(0,i.yg)("p",null,"Open your browser and head to your Jetson IP address and port to run the AUTOMATIC1111's Stable Diffusion webgui"),(0,i.yg)("p",null,(0,i.yg)("em",{parentName:"p"},"http://JetsonIPAddress:7860")),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/19_jetson_webgui.png"})),(0,i.yg)("p",null,"Now we can play with it.\nHere's some images created with the default model. "),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/23_creating_image1.gif"})),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/24_creating_image2.gif"})),(0,i.yg)("h4",{id:"stable-diffusion-xl"},"Stable Diffusion XL"),(0,i.yg)("p",null,"AUTOMATIC1111 supports other models. Let's try with Stable Diffusion XL. It has 6.6 billion parameters. "),(0,i.yg)("p",null,"To add another model, and to be easier to download it, let's define some variables, change permissions and download the models.\nThis is an example from ",(0,i.yg)("a",{parentName:"p",href:"https://www.jetson-ai-lab.com/tutorial_stable-diffusion-xl.html"},"NVIDIA's Tutorial"),"."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"CONTAINERS_DIR=<where_jetson-containers_is_located>\nMODEL_DIR=$CONTAINERS_DIR/data/models/stable-diffusion/models/Stable-diffusion/\nsudo chown -R $USER $MODEL_DIR\n")),(0,i.yg)("p",null,"Now, download the model"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"wget -P $MODEL_DIR https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0/resolve/main/sd_xl_base_1.0.safetensors\nwget -P $MODEL_DIR https://huggingface.co/stabilityai/stable-diffusion-xl-refiner-1.0/resolve/main/sd_xl_refiner_1.0.safetensors\n")),(0,i.yg)("p",null,"With the models downloaded, let's refresh the checkpoints drop-down if you have the container running, or launch the container again. "),(0,i.yg)("p",null,"Now we have two more models available to us. "),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/25_models.png"})),(0,i.yg)("p",null,"This is an example generated with the XL model, with the following prompt:"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"A Portrait, fashionable model wearing futuristic clothing, in a cyberpunk roof-top environment, with a neon-lit city background, backlit by vibrant city glow, fashion photography")),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/26_neon_xl.png"})),"Try it. Remember that, it may not work with some options selected.",(0,i.yg)("h4",{id:"adding-other-models"},"Adding other models"),(0,i.yg)("p",null,"We can also add a lot of more models. Besides Hugging Face, ",(0,i.yg)("a",{parentName:"p",href:"https://civitai.com/"},"Civitai")," is another hub with more models to choose from. Civitai has some NSFW models, so consider yourself warned. "),(0,i.yg)("p",null,"Select the one you want, download the checkpoints and place them in the models directory"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"/home/<user>/<jetson-containers-location>/data/models/stable-diffusion/models/Stable-diffusion/\n")),(0,i.yg)("p",null,"I'm going to download and try a model named ",(0,i.yg)("a",{parentName:"p",href:"https://civitai.com/models/112902/dreamshaper-xl"},"DreamShaper XL"),". "),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/27_dreamshaperxl.png"})),(0,i.yg)("p",null,"Remember that some models may not work. "),(0,i.yg)("p",null,"You need to play with the settings and read the model card to know what settings may work best (if at all). "),(0,i.yg)("p",null,"For example, this model card says that the sampling steps should be 4-8, sampling method should be DPM++ SDE Karras, etc... "),(0,i.yg)("p",null,"Download the model checkpoint and add it to the above directory. "),(0,i.yg)("p",null,"After refreshing , you should have the model ready to select.\nWhen selecting, AUTOMATIC1111 will optimize the model. "),(0,i.yg)("p",null,"If it gets getting killed or an error appears, get more space. It was happening to me and after getting more space, everything worked out. "),(0,i.yg)("p",null,"Using the following prompt"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"holding a staff, orbstaff <lora:orbstaff:0.60> , ,(by Gabriel Isak and Adam Elsheimer:1.20), (by Jon Whitcomb and Bayard Wu and Malcolm Liepke0.80),8k , professional fashion shot")),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://civitai.com/images/8570722"},"from this image"),",\nwithout the negative prompt, I got the following result"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/28_dreamshaperxl_image_result.png"})),(0,i.yg)("p",null,"with these settings:"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/29_dreamshaperXL_settings.png"})),(0,i.yg)("p",null,"Remeber the prompt above for the cyberpunk girl using the ",(0,i.yg)("em",{parentName:"p"},"Stable Diffusion XL")," model? "),(0,i.yg)("p",null,"Here's a new image, with the same prompt, generated with ",(0,i.yg)("em",{parentName:"p"},"DreamShaper XL")," with the same settings above"),(0,i.yg)("div",{align:"center"},(0,i.yg)("img",{width:800,src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/Nvidia_Jetson_recomputer_LLM_texto-to-image/30_cyberpunkGirl.png"})),(0,i.yg)("p",null,"As you can see, wonderful images can be created, granting that you know the parameters to tune. :)"),(0,i.yg)("p",null,"I've learned that bigger images tend to produce better results. "),(0,i.yg)("p",null,"Hope you've learn how to generate images using the Nvidia Jetson NX 16GB and how to use it as a server to generate images on demand. "),(0,i.yg)("h2",{id:"-contributor-project"},"\u2728 Contributor Project"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"This project is supported by the Seeed Studio ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/orgs/Seeed-Studio/projects/6/views/1?pane=issue&itemId=56418890"},"Contributor Project"),"."),(0,i.yg)("li",{parentName:"ul"},"Thanks ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/Seeed-Studio/wiki-documents/issues/1029"},"Bruno's efforts")," and your work will be ",(0,i.yg)("a",{parentName:"li",href:"https://wiki.seeedstudio.com/Honorary-Contributors/"},"exhibited"),".")),(0,i.yg)("h2",{id:"tech-support--product-discussion"},"Tech Support & Product Discussion"),(0,i.yg)("p",null,"Thank you for choosing our products! We are here to provide you with different support to ensure that your experience with our products is as smooth as possible. We offer several communication channels to cater to different preferences and needs."),(0,i.yg)("div",{class:"button_tech_support_container"},(0,i.yg)("a",{href:"https://forum.seeedstudio.com/",class:"button_forum"}),(0,i.yg)("a",{href:"https://www.seeedstudio.com/contacts",class:"button_email"})),(0,i.yg)("div",{class:"button_tech_support_container"},(0,i.yg)("a",{href:"https://discord.gg/eWkprNDMU7",class:"button_discord"}),(0,i.yg)("a",{href:"https://github.com/Seeed-Studio/wiki-documents/discussions/69",class:"button_discussion"})))}m.isMDXComponent=!0}}]);